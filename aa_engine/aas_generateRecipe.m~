%% aas_generateRecipe(aap, analyses)
function currentRecipe = aas_generateRecipe(aap, analyses, prefix)

if nargin < 3
    prefix = 'aap_recipe_';
end

if ~isunix
    error('This function (currently) only runs on Unix based systems currently.')
end

% Need to add path to recipe so that it can be detected...
addpath(aap.acq_details.root)

currentRecipe = fullfile(aap.acq_details.root, 'aa4_current_tasklist.xml');

% Remove current tasklist file and create empty one
try
    unix(['rm ' currentRecipe]);
catch
end
unix(['touch ' currentRecipe]);

% Document begin and initialisation modules
unix(['cat aa4_tasklist_start.xml >> ' currentRecipe]);

% Analyses modules
for iAnalysis = 1:length(analyses)    
    unix(['cat ' prefix analyses{iAnalysis} '.xml >> ' currentRecipe]);    
end

% Garbage collection module and document end
unix(['cat aa4_tasklist_end.xml >> ' currentRecipe]);

% Make file executable and group private...
unix(['chmod 770 ' currentRecipe]);